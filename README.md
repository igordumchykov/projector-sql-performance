# projector-sql-performance
- Generates 40M users insert statement
- Compares inserts based on `innodb_flush_log_at_trx_commit` MySQL property
- Compares selects queries on `date_of_birth` column without index, with b-tree index, wth hash index

# Project structure
1. [script for 40M users](./app)
2. [docker-compose](./docker-compose.yaml) with MySQL container
3. Example of [insert 40M users](./data.sql) file generated by [script for 40M users](./app) 
(example script contains 10k users. To generate 40M users, please follow steps below)

# Run
1. Start MySQL docker container:
```shell
docker-compose up -d
```
2. Generate script to insert 40M users: run 
```shell
./gradlew clean bootRun
```
3. Enter docker container: 
```shell
docker exec -it  projector-sql-performance-mysql-1 /bin/sh
```
4. Login into mysql:
```shell
mysql -u <username> -p
```
5. Set innodb_flush_log_at_trx_commit:
```shell
SET GLOBAL innodb_flush_log_at_trx_commit=0|1|2;
```
6. Run `data.sql` script to insert 40M users

# Comparison Tables
## Insert 40M users

innodb_flush_log_at_trx_commit|execution time, ms
-|-
1|1,515,317
0|1,440,945
2|1,467,968

## Insert 10k users concurrently using 4 threads

innodb_flush_log_at_trx_commit|execution time, ms
-|-
1|3069
0|2667
2|2740

## Select by date_of_birth

<table>
    <thead>
        <tr>
            <th>select statement</th>
            <th>rows selected</th>
            <th>execution time, s</th>
            <th>index type</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td rowspan=3>select * from users where users.users.date_of_birth = '2000-10-09'</td>
            <td rowspan=3>807</td>
            <td>7.3608015</td>
            <td>without index</td>
        </tr>
        <tr>
            <td>0.00719975</td>
            <td>b-tree</td>
        </tr>
        <tr>
            <td>0.0004275</td>
            <td>hash</td>
        </tr>
        <tr>
            <td rowspan=3>select * from users where users.users.date_of_birth like '2000-10-%'</td>
            <td rowspan=3>25057</td>
            <td>0.28041475</td>
            <td>without index</td>
        </tr>
        <tr>
            <td>0.277088</td>
            <td>b-tree</td>
        </tr>
        <tr>
            <td>0.35235125</td>
            <td>hash</td>
        </tr>
        <tr>
            <td rowspan=3>select * from users where users.users.date_of_birth between '1900-10-09' and '2000-10-09'</td>
            <td rowspan=3>29047215</td>
            <td>0.00083925</td>
            <td>without index</td>
        </tr>
        <tr>
            <td>0.0551175</td>
            <td>b-tree</td>
        </tr>
        <tr>
            <td>0.0550575</td>
            <td>hash</td>
        </tr>
    </tbody>
</table>


